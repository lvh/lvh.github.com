
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>lvh</title>
  <meta name="author" content="lvh">

  
  <meta name="description" content="This article will be about a deployment scheduling technique which I call operationally cautious deployment. (I didn&#39;t pick the name so the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.lvh.io/blog/page/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="lvh" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
</script>
<script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36779422-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>

  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.lvh.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  

<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/talks">Talks</a></li>
</ul>

</nav>
  <!-- <header role="banner"><hgroup>
  <h1><a href="/">lvh</a></h1>
  
    <h2>crypto & distributed systems</h2>
  
</hgroup>


</header> -->
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/01/designing-a-continuous-deployment-system-cautious-deployment/">Designing a Continuous Deployment System: Cautious Deployment</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-01T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content">This article will be about a deployment scheduling technique which I call operationally cautious deployment. (I didn&#39;t pick the name so the acronym would end up being OCD! Honest! I swear!).<p /><div>Note: This isn&#39;t <i>new</i>. I didn&#39;t invent it. The fact that a big number of people around the globe with similar problems have come up with this idea independently and that most of them are happy with the results speaks for itself: this is mostly just common sense thinking applied to fixing a real problem. It&#39;s one of those things that sound obvious when you have them explained to you, but you probably wouldn&#39;t come up with unless you spend quiet a bit of time pondering the problem.</div> <p /><div>So you have a wonderful continuous deployment system! Congratulations! You deploy a new version, monitor your cluster of hosts, and create wonderful graphs:</div><p /><div>[[posterous-content:NBFS9fiUjfTCi8Xr5KIW]]<br /> </div><p /><div>Except, of course, it&#39;s not that simple. Your test suite, no matter how much you&#39;ve honed and polished it, is imperfect. It will contain subtle assumptions that just aren&#39;t true in deployment. (When I say &quot;subtle assumptions&quot;, I mean the kind that you don&#39;t know are assumptions until everything blows up.). If you&#39;re going to be deploying software all the time, deploying something that has a fatal mistake in it is a matter of when, not if. So one day, the real graph is going to look something like this:</div> <p /><div>[[posterous-content:5k8ymL4PxLDrYfbFgL8h]]<br /></div><div>It would be much nicer if we could deploy more cautiously. Try it out, and only go through with the complete deployment. A sort of live test, deploying with a feedback loop. That might look a bit like this:</div> <p /><div>[[posterous-content:apvQ27GHbg2rEh2CWgEa]]</div><div>That deploys the new version to 2**N servers, with N starting at 0 and increasing until all servers use the target version. The number of servers deployed to is exponential, because that gives us the behavior we wanted: slow and cautious at first, and rapid as soon as we think it&#39;ll work.</div> <p /><div><div>Of course, that doesn&#39;t give you an example of a failure mode. Failures look a bit like this:</div><div>[[posterous-content:tibBqAUzF8OCiIOWmnDZ]]</div> </div><div>Just like in the previous picture, a roll-out of a new version starts. Except this time, the new version doesn&#39;t actually work. The system catches this, and reverts the hosts that have already converted.</div> <p /><div>Of course, the package is still broken! You didn&#39;t fix the problem yet, you just reduced its impact. Your dev room should still look roughly like an control room from a bad Cold War movie right after the other party&#39;s launched a bunch of nukes.</div> <p /><div>It&#39;s just another bug, albeit a particularly nasty show-stopping one. Like all bugs, they&#39;re not so much bugs in the software as they are bugs in the test suite that incorrectly specified the requirements for the software. This becomes painfully obvious here: there&#39;s something broken, but your test suite didn&#39;t catch it. Hopefully, it&#39;s something that&#39;s at all testable.</div> <p /><div>The difference between this state of panic and the original state of panic is that, ideally, your users never noticed there was a problem.</div><p /><div>There&#39;s one obvious problem with all of this. Being able to continue deployment on positive feedback and revert deployments on negative feedback relies on actually having feedback. Useful health metrics for a cluster are halfway between art and science, and are definitely outside of the scope of this article.</div> <p /><div>The next article will be about another benefit of cautious deployment: continuous <i>availability</i>. That one is probably going to be halfway between an article about continuous deployment and a rant about how people need to learn more statistics.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/30/designing-a-continuous-deployment-system-deployment-formats-and-content/">Designing a Continuous Deployment System: Deployment Formats and Content</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-30T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>Hi and welcome again to my articles on continuous deployment! In this article, I&#39;m going to talk about <i>what</i> exactly I think you should deploy and what format you should use to deploy it in.</div><p /> <div>Again, the stuff here probably isn&#39;t super controversial. I&#39;m probably not kicking any shins in this one unless you&#39;ve already done continuous deployment and you picked something else. Analogous with the last article, if you don&#39;t really care about deployment formats, save yourself the time and don&#39;t bother reading.</div> <p /><div>When getting in touch with a few people I know are doing continuous deployment, there are a number of things I&#39;ve heard people say about formats and what exactly to deploy. Here&#39;s what they used:</div> <div><ol><li>Distribution packages (debs, rpms&#8230;)</li><li>Language&#39;s native packages (eggs, gems, &#8230;)</li><li>The development environment</li><li>The test environment</li></ol></div><div>(Although it appears that this list confounds two things (formats and content); that&#39;s not entirely true. These packages are generated using standard practice packaging rules with standard content, almost as if they were part of a distribution/PyPI/Rubyforge&#8230;)</div> <p /><div>Some people have reported success deploying native packages. It definitely has it&#39;s advantages in terms of accounting, plus you get to use all of the tools already available for managing package installation on large networks. (As a practical example: PPAs and apt repositories in general, together with Landscape or other tools for managing updates for Ubuntu servers.) Hence, the choice for native packages is understandable: in big existing companies, using existing infrastructure is a big plus.</div> <p /><div>When greenfielding, however, I would prefer to avoid both distribution packages and native packages. One problem is that pretty much all of these are designed for system-wide installations. There are methods of getting around this, such as Python&#39;s virtualenvs, but that makes the system specific to a particular language and set of deployment tools, and I&#39;ve already argued in a previous post why I&#39;d rather avoid that unless there really is no better option.<span style="font-family: arial, helvetica, sans-serif;"> Since nowhere near every reasonable development platform has such a sandboxing tool, it&#39;s not possible to form an abstraction over it.</span></div> <p /><div>A related problem is that it&#39;s generally impossible to reliably install multiple versions of these concurrently in a widely supported way (again,with the exception of language-specific tricks like virtualenvs). That&#39;s not necessarily a huge problem, but it does make reverting to an older version slightly harder. That might not seem like a big deal, but easy reverts are a big part of cautious deployment (more about that in the next installment). Additionally, there&#39;s nothing to prevent a bad/broken package from having side effects that break older installs as well &#8211; as usual, shared mutable state is asking for trouble.</div> <p /><div>Another thing I&#39;ve seen people package is their development environment. Unless you&#39;re also using this as the base for your tests, I think this is a very bad idea. I think we&#39;ve all had cases where something worked fine on a development box, and started breaking for new checkouts. During development, all sorts of stuff Some languages/development environments are more susceptible to these problems than others, but they&#39;re prevalent enough to want to avoid the problem altogether.</div> <p /><div>Even if you are testing your development environment, I dislike it for purity reasons. The people doing this said they did that because it was the easiest way to get stuff running, and they just went along with the path of least resistance. As much as I&#39;m willing to believe that&#39;s true, I also believe that if you need a developer to chant some magic runes and sacrifice a chicken over a checkout of your code before it&#39;ll actually work, you&#39;re doing it wrong.</div> <p />I think repackaging test environments for deployment is a sensible idea. I talked this over with Holger Krekel, the guy who wrote <a href="http://codespeak.net/tox/" target="_blank">Tox</a>, and he immediately pointed out a flaw in that plan: it&#39;ll only work reliably if the testing environment is identical to the deployment environment in terms of platform, architecture, versions of available software&#8230; I thought this was a limitation at first, but I&#39;m now convinced this is a useful limitation (another idea I stole from Holger ;)). If you didn&#39;t <i>test</i> it in environment X, what business do you have <i>deploying</i> it there? <p /><div>I think I&#39;ve got most of the annoying administrative stuff out of the way now, maybe we can move on to more interesting things that are actually specific to continuous deployment :-) That starts with the next article, which, as I&#39;ve already hinted above, will be about &quot;cautious deployment&quot;, a robust technique for scheduling deployment.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/29/well-now-this-changes-everything-/">Well Now, This Changes Everything.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>The previously planned crazy installment (I was going to install my own Launchpad instance) has been cancelled (or maybe deferred) to bring you this important announcement.</div>
<p />
<div>For those who still haven&#8217;t heard yet (sorry about the late blog &#8211; this happened around 4AM my time), <a href="http://blog.bitbucket.org/2010/09/29/bitbucket-joins-atlassian/" target="_blank">Atlassian have bought Bitbucket and are doing crazy awesome things with it</a>.</div>
<p />
<div>They changed some pricing plans, too. If you remember <a href="http://lvh.posterous.com/a-continuous-deployment-interlude-picking-a-d">my graph from last time</a>, it now looks a bit more like this:</div>
<div>[[posterous-content:MGLlpFXYHW3ksEDqpcWR]]</div>
<div>If you remember <a href="http://lvh.posterous.com/a-continuous-deployment-interlude-rolling-you">my previous rant</a>, the big problem I had with Launchpad was pricing. Specifically, I think they charged based on the wrong property: number of projects versus size of team.</div>
<p />
<div>So Bitbucket went out and did just that. Every Bitbucket plan now gets an unlimited amount of space and repositories (both public and private!). What they charge on is size of the team. Get this: <em>everyone</em>&nbsp;now gets infinite private repositories that they get to share with 5 people. That pretty much means that Atlassian just gave 80% of the small commercial dev houses I know free hosting. Even better, if you change your plan before October 3, you get 10 users for a year. That&#8217;s 90% of the small commercial dev houses I know right there.</div>
<p />
<div>That&#8217;s pretty darn cool.</div>
<p />
<div>Disclaimer about the graph: my idea of &#8220;big dev house&#8221; probably isn&#8217;t your idea of big dev house. Obviously the $80/month = $960/yr you&#8217;d pay at Bitbucket for unlimited private collaborators is about four times what you&#8217;d pay at Launchpad for an equally sized (that means &#8220;more than fifty&#8221;, mind you) team if they only work on one project. Since they charge based on different properties it&#8217;s very hard to make a sensible price comparison: I think Launchpad has to compete based on features, and not on price, because fifty people working constantly on one project doesn&#8217;t sound like the kind of dev team I&#8217;d like to see more of :)</div>
<p />
<div>I think it&#8217;s time to revisit Bitbucket. Even if most of the tools end up being horrible, you just can&#8217;t argue with &#8216;free&#8217;. If feature X in Bitbucket ends up being unusably bad, I can just install my own code review tool. I&#8217;ve been told Bitbucket repositories are accessible over SVN, so it may even be possible to hook it up to Rietveld and end up with something where I do <em>zero</em> hosting.</div>
<p />
<div>Regardless of what happens to Bitbucket, I&#8217;d like to congratulate Jesper on Atlassian buying Bitbucket and wish him the best of luck in whatever he does next, be it Bitbucket or something else.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/29/we-now-have-an-animal-mascot-/">We Now Have an Animal Mascot!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>(Sorry, I&#8217;ll try to keep the unrelated chatter to a minimum and stick to tech stuff! But this is still pretty related.)</div>
<p />
<p>After a Django pony, testing goat, packaging pig, there is now also a <a href="http://twitter.com/deploymentduck">deployment duck</a>.</p>
<p />
<div>That means, of course, that continuous deployment looks somewhat like this:</div>
<p />
<div><img title="ducklings_ali_465x349.jpg" src="http://www.bbc.co.uk/devon/content/images/2007/03/12/ducklings_ali_465x349.jpg" alt="ducklings_ali_465x349.jpg" /></div>
<p />
<div>Also, <a href="http://xkcd.com/537/">obligatory XKCD</a>.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/29/designing-a-continuous-deployment-system-on-being-language-agnostic/">Designing a Continuous Deployment System: On Being Language Agnostic</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>Hi, and welcome again to my series of rants about continuous deployment :) In the next few posts, I&#39;ll try to scope out what I think a hypothetical greenfielded continuous deployment system should and shouldn&#39;t do, and then get that down to what a <i>feasible</i> continuous deployment system should and shouldn&#39;t do. Hopefully there won&#39;t be too much cutting.</div> <p /><div>Fair word of warning, there&#39;s some ground rules to cover first before I get to talk about anything really interesting. This article, specifically, is about being language agnostic. It&#39;s not exactly a very controversial thing, and is mostly here so I have something to point to when someone asks me why I did X rather than Y. If you&#39;re willing to concede that the added complexity of supporting arbitrary languages and build/deployment systems is worth it, feel free to skip this one.</div> <p /><div>Python&#39;s great and all, but lock-in is pretty much always bad. There&#39;s two big reasons why I think this is worth doing, despite potential added complexity:</div> <div><ol><li>You want other people to use your system.</li><li>You want to be able to use different things, now or in the future.</li> </ol></div><div>The first point is pretty straightforward. For something as critical as a continuous deployment system, you&#39;ll want a lot of other people using it and contributing to it. In CI systems, this sort of traction is what made Buildbot great and Hudson popular. Selling people something that works with whatever it is they have is a lot easier than selling people something that works with whatever it is <i>you</i> have.</div> <p /><div>The second point is just because nothing can be the best way to express every possible problem all the time. You might want to use different tools, if only purely for the sake of experiment.</div><p /><div>If your architecture makes it possible, why not allow a programmer to foray into the slightly unknown? Who knows, you might develop something nice. Programmers are typically creative people: giving them a lot of a freedom to tinker tends to repay itself many times over (Google figured this out with 20% time).</div> <p /><div>The bottom line is simple: don&#39;t make it work for Python only. Or, which is more like what I&#39;m going to do: make it Python only for now, but don&#39;t make it hard for other people to do whatever they like with it.</div> <p /><div>The next article is going to be about <i>what</i> to deploy and the format to deploy it in.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/29/a-continuous-deployment-interlude-rolling-your-own-development-stack/">A Continuous Deployment Interlude: Rolling Your Own Development Stack</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi, and welcome to the second part to my ranting about development stacks.&nbsp;In my previous post, I talked about the issues with some of the popular hosted solutions (Github, Bitbucket and Launchpad). In this post, I&#8217;ll try to roll my own dev stack that hopefully doesn&#8217;t suck too much.</p>
<p />
<div>Recall from the last post that I&#8217;m looking for three things:</div>
<div><ol>
<li>version control</li>
<li>issue tracking</li>
<li>preferably some form of code review</li>
</ol></div>
<div>I think it&#8217;s a good idea if these things are integrated. Specifically, I think it&#8217;s a <em>great</em>&nbsp;idea for all of these things to live in the repository. That makes them very easily accessible at every step along the way: your continuous deployment system shouldn&#8217;t care about deploying software when it has known major bugs in the issue tracker, for example. Code review is integral in resolving tickets, because resolving tickets generally involves changing or adding code (and in both cases, you really should have code review).</div>
<p />
<div>It&#8217;s fine for this code meta-data to be available in other ways than reading it out of the repository, as long as it satisfies some useful definition of &#8220;available&#8221;. You <em>could</em> just speak HTTP to your issue tracker or code review tool&#8217;s web page . It just adds another layer that can break &#8211; people who&#8217;ve had to manage these tools can probably imagine the problems when your fancy new CI system reports failed builds, and it&#8217;s really about Trac being down, or some software upgrade destroying your ability to scrape a web page.</div>
<p />
<div>With that in mind, let&#8217;s look at the available stuff for rolling your own stack. First, I filtered and ordered tools by the amount I&#8217;m willing to put up with them, and came up with:</div>
<div><ol>
<li>Bazaar</li>
<li>Fossil</li>
<li>Mercurial</li>
</ol>(That doesn&#8217;t mean I think everything else won&#8217;t work. It means I didn&#8217;t consider them. I&#8217;m only one guy &#8211; barely have enough time to research this, let alone produce an exhaustive list.)</div>
<p />
<div>For Bazaar, well, outside of Launchpad life isn&#8217;t very interesting and you come up with the usual suspects. For issue tracking and project management you&#8217;ve got stuff like Trac and Redmine. In terms of distributed bug tracking you&#8217;ve got <a href="http://bugseverywhere.org/be/show/HomePage" target="_blank">Bugs Everywhere</a> and <a href="http://ditz.rubyforge.org/" target="_blank">Ditz</a>&nbsp;(I can&#8217;t figure out which is nicer &#8211; I&#8217;m defaulting to BE because it&#8217;s Python so easier for me to extend &#8211; if anyone has experience with both please chime in). In terms of code review, well, there&#8217;s Review Board. None of these things are Bzr-specific (which is great, less lock-in is better, except some of them don&#8217;t have Bazaar support either, which is annoying if it&#8217;s the tool you&#8217;re going to be using all day and every day.)</div>
<p />
<div>Next up: <a href="http://www.fossil-scm.org/index.html/doc/tip/www/index.wiki">Fossil</a>. Fossil is pretty obscure; it&#8217;s an SCM built on top of SQLite, written by the same author. That&#8217;s a big plus, if you didn&#8217;t know it yet, SQLite is some of the most extensively tested, well-engineered yet still simple code out there. Fossil works well with my earlier argument about as much metadata as possible being managed inside your repository. It comes with an integrated wiki and issue tracker. The entire repository is stored in a SQLite database. A nice feature that it shares with Trac is the ability to create your own queries over tickets using SQL. Twisted has used that successfully to improve the code review part of their <a href="http://twistedmatrix.com/trac/report">issue system</a>&nbsp;(see {15}, which is review tickets in the order they should be reviewed). Fossil is also very easy to host: in fact, Fossil&#8217;s website <em>is</em>&nbsp;Fossil serving itself. For. I&#8217;ve had a brief chat with Zed Shaw about Fossil since he&#8217;s used it quite extensively in real projects such as <a href="http://mongrel2.org/home">Mongrel2</a>&nbsp;(note that that&#8217;s Fossil serving that webpage again), and he seemed pretty happy with how it works in general. Fossil&#8217;s easy enough to use for hosting multiple repositories itself: there&#8217;s a somewhat unfortunate but understandable choice for using CGI, so you can use pretty much anything that can serve CGI to serve Fossil web pages for you.</div>
<p />
<div>Last up: Mercurial. When it comes to code review, I&#8217;ve already explained in a previous post why I think Bitbucket&#8217;s pull requests are a missed opportunity. (Short version: they make a distinction between local branches and branches in different repositories, which is in my opinion unnecessary. I think the way Launchpad allows merge proposals between arbitrary branches is much better. Github has recently copied this behavior somewhat with Pull Requests 2.0.). However, the main reason I wanted that is for a point to introduce code review.&nbsp;Georg Brandl (birkenfeld) pointed out that Mercurial has the pretty impressive <a href="https://bitbucket.org/sjl/hg-review/src" target="_blank">hg-review extension</a>. It has a sleek, usable&nbsp;<a href="http://review.stevelosh.com/" target="_blank">web interface</a>&nbsp;(try it!). It also has the advantage of the point I made earlier: data is included with your repository, you don&#8217;t need to go fish for it. Even if you don&#8217;t use that now, it has the great advantage of being able to do cool things with it later (such as identifying recurring problems in the review process and pointing those out to the reviewer/author).</div>
<p />
<div>Stay tuned for the next installment, where I try something totally crazy.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/28/a-continuous-deployment-interlude-picking-a-development-stack/">A Continuous Deployment Interlude: Picking a Development Stack</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-28T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div>
<div>At some point in time, you&#8217;re going to have to pick a set of tools to do your dev work with. You probably want a bunch of things, including:</div>
<div><ol>
<li>A version control system. Preferably not CVS, Visual SourceSafe, ClearCase, Perforce, RCS, SCCS&#8230;</li>
<li>A ticketing system. Preferably not Trac.</li>
<li>A code review system, possibly just informal code review as part of the ticketing system.</li>
</ol></div>
<div>Like pretty much everyone, I&#8217;m not without bias. I <em>love</em> Bazaar. It&#8217;s the best version control system I&#8217;ve ever used (and I&#8217;ve used most of the popular ones). I&#8217;ve got a number of reasons why I prefer it over git and hg, but I&#8217;m not going to debate VCSes here. All of the version control systems I&#8217;ve just named are all pretty great pieces of software, far superior to what we had to put up with before we had them. That&#8217;s unfortunate, because then&nbsp;<a href="http://en.wikipedia.org/wiki/Parkinson's_Law_of_Triviality" target="_blank">Parkinson&#8217;s law of triviality</a>&nbsp;comes into effect, and people who really don&#8217;t even care very much either way will feel the need to defend their favorite piece of software to the death. I think we should come to terms with VCS wars being the new editor wars. (The inverse relation between clue and volume is an unfortunate perennial in these things.)</div>
<p />
<div>At my old place of work, we found a way around that. We had an SVN trunk, and no human was allowed to commit to it. There&#8217;s a bot takes patches which commits to trunk &#8211; and patches are only sent after two (later three) people sign off on the code review. One obvious advantage is that you completely avoid religious wars. I don&#8217;t have to convince people to switch to $AWESOME_VCS. There&#8217;s also the problem of authorship erasure: because the bot commits everything and this was a very simplistic bespoke system, tools like <span style="font-family: courier new, monospace;">svn blame</span> stop working. At first sight, this seems pretty bad. I&#8217;m not entirely convinced: it&#8217;s not great, but on the other hand, it is a sort-of neat way of enforcing collective code ownership. Overall, I think this was a nice experiment, but it&#8217;s about time we stop mucking around and build some better tools.</div>
<p />
<div>I started by looking all of the hosted services and the DVCS that powers them:</div>
<div><ol>
<li>Launchpad with Bazaar.</li>
<li>Bitbucket with Mercurial</li>
<li>Github with git (and <a href="http://github.com/defunkt/hub">hub</a>)</li>
</ol></div>
<div>Because of my affinity for Bazaar, Launchpad obviously came first.&nbsp;Alas, there&#8217;s a problem with Launchpad for small commercial projects. Pricing.</div>
<p />
<div>[[posterous-content:shOrCG05NvDQO8UBylbu]]</div>
<div>Here&#8217;s how it works. Github (in dark red) has a <a href="http://github.com/plans" target="_blank">bunch of plans for private repositories</a>. Bitbucket (in light blue) has a <a href="http://bitbucket.org/plans" target="_blank">bunch of plans for private repositories</a>. Launchpad (in yellow) has a <a href="https://launchpad.net/+tour/join-launchpad" target="_blank">one size fits all $250/yr/project plan</a>.</div>
<p />
<div>I am in no way saying $250 is an unsurmountable amount of money for a company. I am saying that at the low end of the spectrum, you get a whole lot more bang for your buck at Github and especially Bitbucket than you get at Launchpad. The services they provide are not equivalent: merge proposals are quite a bit better than pull requests in both Github and Bitbucket (although Github&#8217;s Pull Request 2.0&#8217;s are halfway there, their pull-request-is-an-issue philosophy makes it impossible to use pull requests as proposed solutions to tickets), and the issue tracker feels a lot more polished than both Github&#8217;s and Bitbucket&#8217;s (although between those two, Bitbucket probably wins that round). I&#8217;m not saying it&#8217;s not better. I&#8217;m saying I&#8217;m having a hard time justifying that it&#8217;s around $200/year/project better. It&#8217;s not that Launchpad&#8217;s expensive as much as the&nbsp;competition&nbsp;is really, really cheap.</div>
<p />
<div>Let&#8217;s say I&#8217;m a tiny bootstrapping startup with somewhere between $10k and $30k to spend. If you&#8217;ve got one project, $250/yr that&#8217;s quite all right. However, building your big app as a set of smaller ones has a number of advantages, in terms of administration and deployment. Once I&#8217;ve got 5+ tiny projects (which, put together, make up the code in my startup), it&#8217;s about $1250/yr. Still not insurmountable, but I&#8217;ve got more interesting things to spend $1k+ on than Launchpad. $1k/year for hosting is not a sensible way to spend your money when most of those projects only get a few tickets a week.</div>
<p />
<div>So, just to be clear: I&#8217;m not saying Launchpad sucks. I think Launchpad is great. I&#8217;m not saying Launchpad&#8217;s pricing scheme is asinine. I&#8217;m saying their pricing scheme works out very badly for what I want to do, and that I&#8217;m having a hard time convincing other people the extra cost is worth the difference in functionality.</div>
<p />
</div>
<div>In the next post, I&#8217;ll talk about rolling your own development stack.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/27/building-a-continuous-deployment-system-part-three-preparing-for-continuous-deployment/">Building a Continuous Deployment System, Part Three, Preparing for Continuous Deployment</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-27T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post is just about the process of moving a dev shop to continuous deployment. If you&#8217;re just interested in the things I&#8217;d like to build, feel free to skip this one.</p>
<p>Despite the ominous messages in my last post about continuous deployment changing your dev shop dramatically, I do think it&#8217;s possible to prepare properly. That means that you get up to the point where you <em>could</em> be doing continuous deployment, but you just aren&#8217;t. Or, to put it differently, imagining you had to release right now, and getting trunk up to the point where that doesn&#8217;t raise your blood pressure.</p>
<p>The first step is getting your testing up to an adequate level. I can&#8217;t stress this enough &#8211; I&#8217;m hoping it won&#8217;t be a tough sale considering the amount of people who&#8217;ve hammered it before me &#8211; given today&#8217;s tools, there is very little excuse left for not having an extensive suite of things that check your code. I&#8217;m deliberately not saying &#8220;unit tests&#8221;, because it encompasses a lot more than just unit tests:</p>
<ol>
<li>unit tests (These still go up as number one because they&#8217;re what you&#8217;re dealing with most. Plus, out of the things in your code that are just plain broken, unit tests will help you find at least 90%.)</li>
<li>static analysis (<a href="http://divmod.org/trac/wiki/DivmodPyflakes">pyflakes</a> is great, but Python is quite hard to do sensible static analysis on &#8211; statically typed languages, for example, can expect to reap much greater benefits)</li>
<li>integration tests (although these are generally part of my normal test suite and are ran together with unit tests, they&#8217;re really quite different)</li>
<li>user interface tests (if you&#8217;re building a webapp, <a href="http://seleniumhq.org/">Selenium</a> is wonderful)</li>
</ol>
<p>Testing is very important, but it&#8217;s hardly the whole story. Testing (with the minor exception of some forms of static analysis) make sure your code <em>works</em>&nbsp;&#8211; it makes no guarantees about that code being any good. For now, computers aren&#8217;t too great at judging code in such as subtle fashion, and you really want humans to do it for you. Especially in languages that let you do pretty much anything, code review is very important if you want to keep your code <em>sane</em>. Like test-driven development, a lot of people much smarter than me have driven this one home for a long time, so I won&#8217;t try to convince you too much.</p>
<p>Another advantage of code review is collective code ownership and a resulting increase in <a href="http://c2.com/cgi/wiki$?BusNumber">bus number</a>. High bus numbers are very important, especially so when you&#8217;re doing continuous deployment. You can&#8217;t, or at least <em>shouldn&#8217;t</em>, delay a release. Once something does go wrong, fixing the situation should be everyone&#8217;s immediate priority. Only one person understanding how a particular part of the project works slows things down. That sounds like a restriction, and in some ways it is, but it&#8217;s the kind of restriction that forces you to do the right thing.</p>
<p>I have found that a lot of people do one kind of code review, and contrast them. I&#8217;ve had good experiences with doing extensive and multiple kinds of code review. Most people believe that to be a waste of time and resources. I&#8217;m not convinced. First of all, there&#8217;s Linus&#8217; Law arguing for many reviewers. Secondly, I&#8217;ve found that different kinds of review (and different kinds of reviewers) spot different problems, because they care about different things:</p>
<ol>
<li>A pair programmer will spot nitpicks about code quality and save you a bunch of &#8220;duh&#8221; moments</li>
<li>A reviewer working on the same project reviewing a feature branch will pay more attention to&nbsp;interoperability&nbsp;issues with the rest of the code</li>
<li>Someone who&#8217;s not even a programmer (yep, &#8220;everybody writes code&#8221; works out great) will spot documentation issues</li>
<li>&#8230; (this is not, by any means, an exhaustive list)</li>
</ol>
<p>Adding a form of code review takes a load off for all of the other forms of code review. The curve is sublinear: adding more code review doesn&#8217;t make code review take proportionally longer (it won&#8217;t make it shorter either, of course).</p>
<p>A lot of people dislike being criticized about their code. <strong>Stamp this behavior out as soon as possible.</strong> Everyone&#8217;s only human, and plenty of ugly, broken or otherwise inadequate code gets written. The point is to get it out, not berating the person that wrote it.</p>
<p>Pressing the big red button once you&#8217;re done will still be scary. You might even have a hiccup or two. But ideally, nothing will blow up. After a while (and probably in less time than you think it will), releases will become, as Timothy Fitz puts it, a non-event.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/26/building-a-continuous-deployment-system-part-two-what-is-it-/">Building a Continuous Deployment System, Part Two: What Is It?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-26T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hi! This is part two of my continuous deployment <span style="text-decoration: line-through;">rant</span>series which started <a href="http://lvh.posterous.com/building-a-continuous-deployment-system-part">here</a>. In this part,&nbsp;I&#8217;ll try to explain what I&#8217;m talking about when I say continuous deployment.</p>
<p>Strictly speaking, continuous deployment just means that you push code out to production servers all the time, practically as it gets written.</p>
<p>Think about that for a second. Are you scared? If so, why? Don&#8217;t feel too bad if you are. Most people I&#8217;ve talked to about this are somewhere halfway between intrigued and terrified, and are mostly glad it&#8217;s not happening to their code. A lot of those people also produce great software anyway. The people that don&#8217;t feel anxious at all either haven&#8217;t produced enough production software yet, or are already busy doing continuous deployment.</p>
<p>People who already practice continuous integration, with all sorts of tests and code quality metrics, often talk about how trunk is always ready for production. Continuous deployment is about putting your money where your mouth is and actually doing just that. The basic idea is similar to that of continuous integration: test as many things as you sensibly can and fail as quickly as possible once things go awry. Hopefully, that&#8217;ll contain minor hiccups before they become real problems (generally defined as &#8220;the kind that costs revenue&#8221;).</p>
<p>However, I don&#8217;t think the strict definition is a very useful thing to do or talk about purely by itself. I&#8217;ve learned that continuous deployment doesn&#8217;t come alone. Much more so than continuous integration, which feels like a natural extension of TDD, continuous deployment pretty much turns your development process upside down. Doing continuous deployment without a disciplined team to back it up and a testing infrastructure to constantly check your work is a bit like having a transmission without an engine and a steering wheel. (I apologize for the car analogy, and promise to try and not make a habit out of it.)</p>
<p>From what I&#8217;ve read and my own experience, teams who have successfully applied continuous deployment see these two things come back&nbsp;inseparably. If you want to make sure your code isn&#8217;t plain broken, you better have a wide array of tests. If you want to make sure the code you&#8217;re now responsible for in production isn&#8217;t terrible, you better be doing code review (pair programming and/or tool-assisted code review is great &#8211; we&#8217;ve had success doing both). There&#8217;s nothing quite like the first time you commit a file and then&nbsp;watching your shiny new piece of code do something on a production server less than a minute later.</p>
<p>So, I guess the series is partially about continuous deployment proper, and partly about greenfielding a development process that rocks.</p>
<p>&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/26/building-a-continuous-deployment-system-part-one/">Building a Continuous Deployment System, Part One</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-26T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Lately, I&#8217;ve been thinking a lot about building a continuous deployment system.</p>
<p>I was really glad to find out that Timothy Fitz was doing <a href="http://timothyfitz.wordpress.com/2009/02/10/continuous-deployment-at-imvu-doing-the-impossible-fifty-times-a-day/">continuous deployment over at IMVU</a>&nbsp;(partially because Timothy and I like some of the same software). Eric Ries, former CTO and co-founder of IMVU, has had a lot of <a href="http://www.startuplessonslearned.com/search/label/continuous%20deployment">interesting things</a> to say about it as well. I used to do this at my old day job, and it&#8217;s been an absolute eye-opener &#8211; yes, it does require quite a bit of discipline, but I&#8217;m convinced it pays off handsomely, especially in the long run.</p>
<p>Despite my newfound conviction, the system we used there wasn&#8217;t all that fancy. That has its upsides, the less complex it is, the less can go wrong. Unfortunately, being a horrendous hodgepodge (I&#8217;d call it an unholy alliance, but there&#8217;s no VB or COBOL) of bash, perl and Python distributing software with rsync, it&#8217;s not very suitable for showing off.</p>
<p>The goal of this series of blog posts is to end up with a continuous deployment system people can agree on. (If you&#8217;re laughing, yes, I realize that&#8217;s probably a little naive &#8211; I&#8217;m hoping to come out relatively unscathed and with a continuous deployment system I can agree on.)</p>
<p>&nbsp;</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    
    <a class="next" href="/blog/page/2/"><i class="fa fa-chevron-circle-right fa-2x icon-color icon-homepage"></i></a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <a class="twitter-timeline"  href="https://twitter.com/lvh"  data-widget-id="451753700516585472">Tweets by @lvh</a>
    <script>!function(d,s,id){var
      js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/29/on-truecrypt-and-full-disk-encryption/">On TrueCrypt and Full-disk Encryption</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/06/more-on-financial-aid-grant-optimization/">More on Financial Aid Grant Optimization</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/18/optimal-hotel-room-pairing/">Optimal Hotel Room Pairing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/10/optimization-problems-and-pycon-financial-aid/">Optimization Problems and PyCon Financial Aid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/12/18/external-drive-lossage-on-mavericks/">External Drive Lossage on Mavericks</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/lvh">@lvh</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'lvh',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <!-- <footer role="contentinfo"><p>
  Copyright &copy; 2014 - lvh -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>



</footer> -->
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
